# ThinkRank API Documentation

## Overview

The ThinkRank API provides programmatic access to our AI content detection gaming platform. All API endpoints are RESTful and return JSON responses.

## Base URL

```
https://api.thinkrank.io/v1
```

For local development:
```
http://localhost:3000/api
```

## Authentication

Most endpoints require authentication using JWT tokens.

### Obtaining Tokens

```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "your-password"
}
```

Response:
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "123",
    "email": "user@example.com",
    "username": "user123"
  }
}
```

### Using Tokens

Include the access token in the Authorization header:
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Refreshing Tokens

```http
POST /auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

## Endpoints

### Authentication

#### Register User
```http
POST /auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "username": "user123",
  "password": "securepassword"
}
```

#### Login
```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "securepassword"
}
```

#### Logout
```http
POST /auth/logout
Authorization: Bearer {token}
```

#### Update Profile
```http
PUT /auth/profile
Authorization: Bearer {token}
Content-Type: application/json

{
  "username": "newusername",
  "bio": "AI enthusiast and gamer"
}
```

### Games

#### Start New Game
```http
POST /games/start
Authorization: Bearer {token}
Content-Type: application/json

{
  "mode": "classic",
  "difficulty": "medium"
}
```

Response:
```json
{
  "id": "game-123",
  "mode": "classic",
  "difficulty": "medium",
  "status": "active",
  "currentChallenge": {
    "id": "challenge-456",
    "type": "text",
    "content": "...",
    "timeLimit": 30
  }
}
```

#### Submit Answer
```http
POST /games/{gameId}/answer
Authorization: Bearer {token}
Content-Type: application/json

{
  "challengeId": "challenge-456",
  "answer": true,
  "confidence": 75,
  "timeSpent": 15
}
```

Response:
```json
{
  "correct": true,
  "explanation": "This text was generated by GPT-4...",
  "pointsEarned": 100,
  "streak": 3,
  "nextChallenge": {
    "id": "challenge-789",
    "type": "image",
    "content": "...",
    "timeLimit": 45
  }
}
```

#### Get Game Details
```http
GET /games/{gameId}
Authorization: Bearer {token}
```

#### Get Game History
```http
GET /games/history
Authorization: Bearer {token}
```

Query parameters:
- `limit`: Number of games to return (default: 20, max: 100)
- `offset`: Pagination offset (default: 0)
- `mode`: Filter by game mode
- `status`: Filter by status (completed, abandoned)

### Leaderboards

#### Global Leaderboard
```http
GET /games/leaderboard
```

Query parameters:
- `period`: Time period (daily, weekly, monthly, all-time)
- `mode`: Game mode filter
- `limit`: Number of entries (default: 100)

#### Friends Leaderboard
```http
GET /games/leaderboard/friends
Authorization: Bearer {token}
```

### AI Detection

#### Generate Challenge
```http
POST /ai/generate
Authorization: Bearer {token}
Content-Type: application/json

{
  "type": "text",
  "difficulty": "hard",
  "topic": "technology"
}
```

#### Detect Content
```http
POST /ai/detect
Authorization: Bearer {token}
Content-Type: application/json

{
  "type": "text",
  "content": "The text to analyze..."
}
```

Response:
```json
{
  "isAI": true,
  "confidence": 0.89,
  "indicators": [
    "Uniform sentence structure",
    "Lack of personal anecdotes",
    "Consistent formal tone"
  ],
  "model": "gpt-4"
}
```

### Social Features

#### Get Teams
```http
GET /social/teams
Authorization: Bearer {token}
```

#### Create Team
```http
POST /social/teams
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "AI Detectives",
  "description": "We spot AI content like pros!",
  "isPublic": true
}
```

#### Join Team
```http
POST /social/teams/{teamId}/join
Authorization: Bearer {token}
```

#### Send Friend Request
```http
POST /social/friends/invite
Authorization: Bearer {token}
Content-Type: application/json

{
  "userId": "user-789"
}
```

#### Get Friend Requests
```http
GET /social/friends/requests
Authorization: Bearer {token}
```

#### Accept Friend Request
```http
POST /social/friends/requests/{requestId}/accept
Authorization: Bearer {token}
```

### User Statistics

#### Get User Stats
```http
GET /users/{userId}/stats
Authorization: Bearer {token}
```

Response:
```json
{
  "userId": "user-123",
  "totalGames": 150,
  "wins": 120,
  "accuracy": 0.85,
  "averageConfidence": 72,
  "totalPoints": 15000,
  "rank": 42,
  "achievements": [
    {
      "id": "sharp-eye",
      "name": "Sharp Eye",
      "description": "Correctly identify 50 AI images",
      "unlockedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "streaks": {
    "current": 5,
    "best": 23
  }
}
```

#### Get Achievements
```http
GET /users/{userId}/achievements
Authorization: Bearer {token}
```

## Error Responses

All errors follow a consistent format:

```json
{
  "error": {
    "code": "INVALID_INPUT",
    "message": "The provided input is invalid",
    "details": {
      "field": "email",
      "reason": "Invalid email format"
    }
  }
}
```

Common error codes:
- `UNAUTHORIZED`: Missing or invalid authentication
- `FORBIDDEN`: Insufficient permissions
- `NOT_FOUND`: Resource not found
- `INVALID_INPUT`: Invalid request data
- `RATE_LIMITED`: Too many requests
- `SERVER_ERROR`: Internal server error

## Rate Limiting

API requests are rate limited:
- Authenticated users: 1000 requests per hour
- Unauthenticated users: 100 requests per hour

Rate limit headers:
```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

## Webhooks

Configure webhooks to receive real-time notifications:

```http
POST /webhooks
Authorization: Bearer {token}
Content-Type: application/json

{
  "url": "https://your-server.com/webhook",
  "events": ["game.completed", "achievement.unlocked"],
  "secret": "your-webhook-secret"
}
```

## WebSocket Events

Connect to real-time updates:

```javascript
const ws = new WebSocket('wss://api.thinkrank.io/ws');

ws.on('open', () => {
  ws.send(JSON.stringify({
    type: 'auth',
    token: 'your-jwt-token'
  }));
});

ws.on('message', (data) => {
  const event = JSON.parse(data);
  // Handle events: game.update, leaderboard.change, etc.
});
```

## SDK Examples

### JavaScript/TypeScript
```typescript
import { ThinkRankClient } from '@thinkrank/sdk';

const client = new ThinkRankClient({
  apiKey: 'your-api-key'
});

// Start a game
const game = await client.games.start({
  mode: 'classic',
  difficulty: 'medium'
});

// Submit answer
const result = await client.games.submitAnswer(game.id, {
  challengeId: game.currentChallenge.id,
  answer: true,
  confidence: 80
});
```

### Python
```python
from thinkrank import ThinkRankClient

client = ThinkRankClient(api_key='your-api-key')

# Start a game
game = client.games.start(mode='classic', difficulty='medium')

# Submit answer
result = client.games.submit_answer(
    game_id=game.id,
    challenge_id=game.current_challenge.id,
    answer=True,
    confidence=80
)
```

## Support

For API support:
- Email: api-support@thinkrank.io
- Discord: [ThinkRank Developers](https://discord.gg/thinkrank-dev)
- GitHub: [API Issues](https://github.com/thinkrank/thinkrank/issues)